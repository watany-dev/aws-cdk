"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lib_1 = require("../lib");
const util_1 = require("../lib/util");
describe('util', () => {
    test('capitalizeResourceProperties capitalizes all keys of an object (recursively) from camelCase to PascalCase', () => {
        const c = new lib_1.Stack();
        expect((0, util_1.capitalizePropertyNames)(c, undefined)).toEqual(undefined);
        expect((0, util_1.capitalizePropertyNames)(c, 12)).toEqual(12);
        expect((0, util_1.capitalizePropertyNames)(c, 'hello')).toEqual('hello');
        expect((0, util_1.capitalizePropertyNames)(c, ['hello', 88])).toEqual(['hello', 88]);
        expect((0, util_1.capitalizePropertyNames)(c, { Hello: 'world', hey: 'dude' })).toEqual({ Hello: 'world', Hey: 'dude' });
        expect((0, util_1.capitalizePropertyNames)(c, [1, 2, { three: 3 }])).toEqual([1, 2, { Three: 3 }]);
        expect((0, util_1.capitalizePropertyNames)(c, { Hello: 'world', recursive: { foo: 123, there: { another: ['hello', { world: 123 }] } } })).toEqual({ Hello: 'world', Recursive: { Foo: 123, There: { Another: ['hello', { World: 123 }] } } });
        // make sure tokens are resolved and result is also capitalized
        expect((0, util_1.capitalizePropertyNames)(c, { hello: { resolve: () => ({ foo: 'bar' }) }, world: new SomeToken() })).toEqual({ Hello: { Foo: 'bar' }, World: 100 });
    });
    describe('ignoreEmpty', () => {
        test('[]', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)([]))).toEqual(undefined);
        });
        test('{}', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)({}))).toEqual(undefined);
        });
        test('undefined/null', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)(undefined))).toEqual(undefined);
            expect(stack.resolve((0, util_1.ignoreEmpty)(null))).toEqual(null);
        });
        test('primitives', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)(12))).toEqual(12);
            expect(stack.resolve((0, util_1.ignoreEmpty)('12'))).toEqual('12');
        });
        test('non-empty arrays/objects', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)([1, 2, 3, undefined]))).toEqual([1, 2, 3]); // undefined array values is cleaned up by "resolve"
            expect(stack.resolve((0, util_1.ignoreEmpty)({ o: 1, b: 2, j: 3 }))).toEqual({ o: 1, b: 2, j: 3 });
        });
        test('resolve first', () => {
            const stack = new lib_1.Stack();
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => 123 } }))).toEqual({ xoo: 123 });
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => undefined } }))).toEqual(undefined);
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => [] } }))).toEqual({ xoo: [] });
            expect(stack.resolve((0, util_1.ignoreEmpty)({ xoo: { resolve: () => [undefined, undefined] } }))).toEqual({ xoo: [] });
        });
    });
    describe('filterUnderined', () => {
        test('is null-safe (aka treats null and undefined the same)', () => {
            expect((0, util_1.filterUndefined)({ 'a null': null, 'a not null': true })).toEqual({ 'a not null': true });
        });
        test('removes undefined, but leaves the rest', () => {
            expect((0, util_1.filterUndefined)({ 'an undefined': undefined, 'yes': true })).toEqual({ yes: true });
        });
    });
    test('pathToTopLevelStack returns the array of stacks that lead to a stack', () => {
        const a = new lib_1.Stack(undefined, 'a');
        const aa = new Nested(a, 'aa');
        const aaa = new Nested(aa, 'aaa');
        expect(path(aaa)).toEqual(['a', 'aa', 'aaa']);
        expect(path(aa)).toEqual(['a', 'aa']);
        expect(path(a)).toEqual(['a']);
        function path(s) {
            return (0, util_1.pathToTopLevelStack)(s).map(x => x.node.id);
        }
    });
    test('findCommonStack returns the lowest common stack between two stacks or undefined', () => {
        const a = new lib_1.Stack(undefined, 'a');
        const aa = new Nested(a, 'aa');
        const ab = new Nested(a, 'ab');
        const aaa = new Nested(aa, 'aaa');
        const aab = new Nested(aa, 'aab');
        const aba = new Nested(ab, 'aba');
        const b = new lib_1.Stack(undefined, 'b');
        const ba = new Nested(b, 'ba');
        const baa = new Nested(ba, 'baa');
        expect(lca(a, b)).toEqual(undefined);
        expect(lca(aa, ab)).toEqual('a');
        expect(lca(ab, aa)).toEqual('a');
        expect(lca(aa, aba)).toEqual('a');
        expect(lca(aba, aa)).toEqual('a');
        expect(lca(ab, aba)).toEqual('ab');
        expect(lca(aba, ab)).toEqual('ab');
        expect(lca(aba, aba)).toEqual('aba');
        expect(lca(aa, aa)).toEqual('aa');
        expect(lca(a, aaa)).toEqual('a');
        expect(lca(aaa, aab)).toEqual('aa');
        expect(lca(aaa, b)).toEqual(undefined);
        expect(lca(aaa, ba)).toEqual(undefined);
        expect(lca(baa, ba)).toEqual('ba');
        function lca(s1, s2) {
            const res = (0, util_1.findLastCommonElement)((0, util_1.pathToTopLevelStack)(s1), (0, util_1.pathToTopLevelStack)(s2));
            if (!res) {
                return undefined;
            }
            return res.node.id;
        }
    });
});
class SomeToken {
    constructor() {
        this.foo = 60;
        this.goo = 40;
    }
    resolve() {
        return this.foo + this.goo;
    }
}
class Nested extends lib_1.Stack {
    constructor(scope, id) {
        const resource = new lib_1.CfnResource(scope, `${id}+NestedStackResource`, { type: 'AWS::CloudFormation::Stack' });
        super(scope, id);
        this.nestedStackResource = resource;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsidXRpbC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQ0EsZ0NBQTRDO0FBQzVDLHNDQUFnSTtBQUVoSSxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRTtJQUNwQixJQUFJLENBQUMsMkdBQTJHLEVBQUUsR0FBRyxFQUFFO1FBQ3JILE1BQU0sQ0FBQyxHQUFHLElBQUksV0FBSyxFQUFFLENBQUM7UUFFdEIsTUFBTSxDQUFDLElBQUEsOEJBQXVCLEVBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2pFLE1BQU0sQ0FBQyxJQUFBLDhCQUF1QixFQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNuRCxNQUFNLENBQUMsSUFBQSw4QkFBdUIsRUFBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0QsTUFBTSxDQUFDLElBQUEsOEJBQXVCLEVBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN6RSxNQUFNLENBQUMsSUFBQSw4QkFBdUIsRUFBQyxDQUFDLEVBQzlCLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FDekMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxJQUFBLDhCQUF1QixFQUFDLENBQUMsRUFDOUIsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRSxD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RSxLQUFLLENBQUMsQ0FBQztRQUNsQyxNQUFNLEdBQUcsR0FBRyxJQUFJLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEMsTUFBTSxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRWxDLE1BQU0sQ0FBQyxHQUFHLElBQUksV0FBSyxDQUFDLFNBQVMsRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNwQyxNQUFNLEVBQUUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDL0IsTUFBTSxHQUFHLEdBQUcsSUFBSSxNQUFNLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBRWxDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRW5DLFNBQVMsR0FBRyxDQUFDLEVBQVMsRUFBRSxFQUFTO1lBQy9CLE1BQU0sR0FBRyxHQUFHLElBQUEsNEJBQXFCLEVBQUMsSUFBQSwwQkFBbUIsRUFBQyxFQUFFLENBQUMsRUFBRSxJQUFBLDBCQUFtQixFQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDcEYsSUFBSSxDQUFDLEdBQUcsRUFBRTtnQkFBRSxPQUFPLFNBQVMsQ0FBQzthQUFFO1lBQy9CLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDckIsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxNQUFNLFNBQVM7SUFBZjtRQUNTLFFBQUcsR0FBRyxFQUFFLENBQUM7UUFDVCxRQUFHLEdBQUcsRUFBRSxDQUFDO0lBSWxCLENBQUM7SUFIUSxPQUFPO1FBQ1osT0FBTyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7SUFDN0IsQ0FBQztDQUNGO0FBRUQsTUFBTSxNQUFPLFNBQVEsV0FBSztJQUV4QixZQUFZLEtBQWdCLEVBQUUsRUFBVTtRQUN0QyxNQUFNLFFBQVEsR0FBRyxJQUFJLGlCQUFXLENBQUMsS0FBSyxFQUFFLEdBQUcsRUFBRSxzQkFBc0IsRUFBRSxFQUFFLElBQUksRUFBRSw0QkFBNEIsRUFBRSxDQUFDLENBQUM7UUFDN0csS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNqQixJQUFJLENBQUMsbUJBQW1CLEdBQUcsUUFBUSxDQUFDO0lBQ3RDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbnN0cnVjdCB9IGZyb20gJ2NvbnN0cnVjdHMnO1xuaW1wb3J0IHsgQ2ZuUmVzb3VyY2UsIFN0YWNrIH0gZnJvbSAnLi4vbGliJztcbmltcG9ydCB7IGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzLCBmaWx0ZXJVbmRlZmluZWQsIGZpbmRMYXN0Q29tbW9uRWxlbWVudCwgaWdub3JlRW1wdHksIHBhdGhUb1RvcExldmVsU3RhY2sgfSBmcm9tICcuLi9saWIvdXRpbCc7XG5cbmRlc2NyaWJlKCd1dGlsJywgKCkgPT4ge1xuICB0ZXN0KCdjYXBpdGFsaXplUmVzb3VyY2VQcm9wZXJ0aWVzIGNhcGl0YWxpemVzIGFsbCBrZXlzIG9mIGFuIG9iamVjdCAocmVjdXJzaXZlbHkpIGZyb20gY2FtZWxDYXNlIHRvIFBhc2NhbENhc2UnLCAoKSA9PiB7XG4gICAgY29uc3QgYyA9IG5ldyBTdGFjaygpO1xuXG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsIHVuZGVmaW5lZCkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYywgMTIpKS50b0VxdWFsKDEyKTtcbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYywgJ2hlbGxvJykpLnRvRXF1YWwoJ2hlbGxvJyk7XG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsIFsnaGVsbG8nLCA4OF0pKS50b0VxdWFsKFsnaGVsbG8nLCA4OF0pO1xuICAgIGV4cGVjdChjYXBpdGFsaXplUHJvcGVydHlOYW1lcyhjLFxuICAgICAgeyBIZWxsbzogJ3dvcmxkJywgaGV5OiAnZHVkZScgfSkpLnRvRXF1YWwoXG4gICAgICB7IEhlbGxvOiAnd29ybGQnLCBIZXk6ICdkdWRlJyB9KTtcbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYyxcbiAgICAgIFsxLCAyLCB7IHRocmVlOiAzIH1dKSkudG9FcXVhbChcbiAgICAgIFsxLCAyLCB7IFRocmVlOiAzIH1dKTtcbiAgICBleHBlY3QoY2FwaXRhbGl6ZVByb3BlcnR5TmFtZXMoYyxcbiAgICAgIHsgSGVsbG86ICd3b3JsZCcsIHJlY3Vyc2l2ZTogeyBmb286IDEyMywgdGhlcmU6IHsgYW5vdGhlcjogWydoZWxsbycsIHsgd29ybGQ6IDEyMyB9XSB9IH0gfSkpLnRvRXF1YWwoXG4gICAgICB7IEhlbGxvOiAnd29ybGQnLCBSZWN1cnNpdmU6IHsgRm9vOiAxMjMsIFRoZXJlOiB7IEFub3RoZXI6IFsnaGVsbG8nLCB7IFdvcmxkOiAxMjMgfV0gfSB9IH0pO1xuXG4gICAgLy8gbWFrZSBzdXJlIHRva2VucyBhcmUgcmVzb2x2ZWQgYW5kIHJlc3VsdCBpcyBhbHNvIGNhcGl0YWxpemVkXG4gICAgZXhwZWN0KGNhcGl0YWxpemVQcm9wZXJ0eU5hbWVzKGMsXG4gICAgICB7IGhlbGxvOiB7IHJlc29sdmU6ICgpID0+ICh7IGZvbzogJ2JhcicgfSkgfSwgd29ybGQ6IG5ldyBTb21lVG9rZW4oKSB9KSkudG9FcXVhbChcbiAgICAgIHsgSGVsbG86IHsgRm9vOiAnYmFyJyB9LCBXb3JsZDogMTAwIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnaWdub3JlRW1wdHknLCAoKSA9PiB7XG4gICAgdGVzdCgnW10nLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoW10pKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgne30nLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoe30pKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgndW5kZWZpbmVkL251bGwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkodW5kZWZpbmVkKSkpLnRvRXF1YWwodW5kZWZpbmVkKTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KG51bGwpKSkudG9FcXVhbChudWxsKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3ByaW1pdGl2ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoMTIpKSkudG9FcXVhbCgxMik7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSgnMTInKSkpLnRvRXF1YWwoJzEyJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdub24tZW1wdHkgYXJyYXlzL29iamVjdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoWzEsIDIsIDMsIHVuZGVmaW5lZF0pKSkudG9FcXVhbChbMSwgMiwgM10pOyAvLyB1bmRlZmluZWQgYXJyYXkgdmFsdWVzIGlzIGNsZWFuZWQgdXAgYnkgXCJyZXNvbHZlXCJcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KHsgbzogMSwgYjogMiwgajogMyB9KSkpLnRvRXF1YWwoeyBvOiAxLCBiOiAyLCBqOiAzIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgncmVzb2x2ZSBmaXJzdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gICAgICBleHBlY3Qoc3RhY2sucmVzb2x2ZShpZ25vcmVFbXB0eSh7IHhvbzogeyByZXNvbHZlOiAoKSA9PiAxMjMgfSB9KSkpLnRvRXF1YWwoeyB4b286IDEyMyB9KTtcbiAgICAgIGV4cGVjdChzdGFjay5yZXNvbHZlKGlnbm9yZUVtcHR5KHsgeG9vOiB7IHJlc29sdmU6ICgpID0+IHVuZGVmaW5lZCB9IH0pKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoeyB4b286IHsgcmVzb2x2ZTogKCkgPT4gW10gfSB9KSkpLnRvRXF1YWwoeyB4b286IFtdIH0pO1xuICAgICAgZXhwZWN0KHN0YWNrLnJlc29sdmUoaWdub3JlRW1wdHkoeyB4b286IHsgcmVzb2x2ZTogKCkgPT4gW3VuZGVmaW5lZCwgdW5kZWZpbmVkXSB9IH0pKSkudG9FcXVhbCh7IHhvbzogW10gfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdmaWx0ZXJVbmRlcmluZWQnLCAoKSA9PiB7XG4gICAgdGVzdCgnaXMgbnVsbC1zYWZlIChha2EgdHJlYXRzIG51bGwgYW5kIHVuZGVmaW5lZCB0aGUgc2FtZSknLCAoKSA9PiB7XG4gICAgICBleHBlY3QoZmlsdGVyVW5kZWZpbmVkKHsgJ2EgbnVsbCc6IG51bGwsICdhIG5vdCBudWxsJzogdHJ1ZSB9KSkudG9FcXVhbCh7ICdhIG5vdCBudWxsJzogdHJ1ZSB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3JlbW92ZXMgdW5kZWZpbmVkLCBidXQgbGVhdmVzIHRoZSByZXN0JywgKCkgPT4ge1xuICAgICAgZXhwZWN0KGZpbHRlclVuZGVmaW5lZCh7ICdhbiB1bmRlZmluZWQnOiB1bmRlZmluZWQsICd5ZXMnOiB0cnVlIH0pKS50b0VxdWFsKHsgeWVzOiB0cnVlIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICB0ZXN0KCdwYXRoVG9Ub3BMZXZlbFN0YWNrIHJldHVybnMgdGhlIGFycmF5IG9mIHN0YWNrcyB0aGF0IGxlYWQgdG8gYSBzdGFjaycsICgpID0+IHtcbiAgICBjb25zdCBhID0gbmV3IFN0YWNrKHVuZGVmaW5lZCwgJ2EnKTtcbiAgICBjb25zdCBhYSA9IG5ldyBOZXN0ZWQoYSwgJ2FhJyk7XG4gICAgY29uc3QgYWFhID0gbmV3IE5lc3RlZChhYSwgJ2FhYScpO1xuXG4gICAgZXhwZWN0KHBhdGgoYWFhKSkudG9FcXVhbChbJ2EnLCAnYWEnLCAnYWFhJ10pO1xuICAgIGV4cGVjdChwYXRoKGFhKSkudG9FcXVhbChbJ2EnLCAnYWEnXSk7XG4gICAgZXhwZWN0KHBhdGgoYSkpLnRvRXF1YWwoWydhJ10pO1xuICAgIGZ1bmN0aW9uIHBhdGgoczogU3RhY2spIHtcbiAgICAgIHJldHVybiBwYXRoVG9Ub3BMZXZlbFN0YWNrKHMpLm1hcCh4ID0+IHgubm9kZS5pZCk7XG4gICAgfVxuICB9KTtcblxuICB0ZXN0KCdmaW5kQ29tbW9uU3RhY2sgcmV0dXJucyB0aGUgbG93ZXN0IGNvbW1vbiBzdGFjayBiZXR3ZWVuIHR3byBzdGFja3Mgb3IgdW5kZWZpbmVkJywgKCkgPT4ge1xuICAgIGNvbnN0IGEgPSBuZXcgU3RhY2sodW5kZWZpbmVkLCAnYScpO1xuICAgIGNvbnN0IGFhID0gbmV3IE5lc3RlZChhLCAnYWEnKTtcbiAgICBjb25zdCBhYiA9IG5ldyBOZXN0ZWQoYSwgJ2FiJyk7XG4gICAgY29uc3QgYWFhID0gbmV3IE5lc3RlZChhYSwgJ2FhYScpO1xuICAgIGNvbnN0IGFhYiA9IG5ldyBOZXN0ZWQoYWEsICdhYWInKTtcbiAgICBjb25zdCBhYmEgPSBuZXcgTmVzdGVkKGFiLCAnYWJhJyk7XG5cbiAgICBjb25zdCBiID0gbmV3IFN0YWNrKHVuZGVmaW5lZCwgJ2InKTtcbiAgICBjb25zdCBiYSA9IG5ldyBOZXN0ZWQoYiwgJ2JhJyk7XG4gICAgY29uc3QgYmFhID0gbmV3IE5lc3RlZChiYSwgJ2JhYScpO1xuXG4gICAgZXhwZWN0KGxjYShhLCBiKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgIGV4cGVjdChsY2EoYWEsIGFiKSkudG9FcXVhbCgnYScpO1xuICAgIGV4cGVjdChsY2EoYWIsIGFhKSkudG9FcXVhbCgnYScpO1xuICAgIGV4cGVjdChsY2EoYWEsIGFiYSkpLnRvRXF1YWwoJ2EnKTtcbiAgICBleHBlY3QobGNhKGFiYSwgYWEpKS50b0VxdWFsKCdhJyk7XG4gICAgZXhwZWN0KGxjYShhYiwgYWJhKSkudG9FcXVhbCgnYWInKTtcbiAgICBleHBlY3QobGNhKGFiYSwgYWIpKS50b0VxdWFsKCdhYicpO1xuICAgIGV4cGVjdChsY2EoYWJhLCBhYmEpKS50b0VxdWFsKCdhYmEnKTtcbiAgICBleHBlY3QobGNhKGFhLCBhYSkpLnRvRXF1YWwoJ2FhJyk7XG4gICAgZXhwZWN0KGxjYShhLCBhYWEpKS50b0VxdWFsKCdhJyk7XG4gICAgZXhwZWN0KGxjYShhYWEsIGFhYikpLnRvRXF1YWwoJ2FhJyk7XG4gICAgZXhwZWN0KGxjYShhYWEsIGIpKS50b0VxdWFsKHVuZGVmaW5lZCk7XG4gICAgZXhwZWN0KGxjYShhYWEsIGJhKSkudG9FcXVhbCh1bmRlZmluZWQpO1xuICAgIGV4cGVjdChsY2EoYmFhLCBiYSkpLnRvRXF1YWwoJ2JhJyk7XG5cbiAgICBmdW5jdGlvbiBsY2EoczE6IFN0YWNrLCBzMjogU3RhY2spIHtcbiAgICAgIGNvbnN0IHJlcyA9IGZpbmRMYXN0Q29tbW9uRWxlbWVudChwYXRoVG9Ub3BMZXZlbFN0YWNrKHMxKSwgcGF0aFRvVG9wTGV2ZWxTdGFjayhzMikpO1xuICAgICAgaWYgKCFyZXMpIHsgcmV0dXJuIHVuZGVmaW5lZDsgfVxuICAgICAgcmV0dXJuIHJlcy5ub2RlLmlkO1xuICAgIH1cbiAgfSk7XG59KTtcblxuY2xhc3MgU29tZVRva2VuIHtcbiAgcHVibGljIGZvbyA9IDYwO1xuICBwdWJsaWMgZ29vID0gNDA7XG4gIHB1YmxpYyByZXNvbHZlKCkge1xuICAgIHJldHVybiB0aGlzLmZvbyArIHRoaXMuZ29vO1xuICB9XG59XG5cbmNsYXNzIE5lc3RlZCBleHRlbmRzIFN0YWNrIHtcbiAgcHVibGljIHJlYWRvbmx5IG5lc3RlZFN0YWNrUmVzb3VyY2U/OiBDZm5SZXNvdXJjZTtcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZykge1xuICAgIGNvbnN0IHJlc291cmNlID0gbmV3IENmblJlc291cmNlKHNjb3BlLCBgJHtpZH0rTmVzdGVkU3RhY2tSZXNvdXJjZWAsIHsgdHlwZTogJ0FXUzo6Q2xvdWRGb3JtYXRpb246OlN0YWNrJyB9KTtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuICAgIHRoaXMubmVzdGVkU3RhY2tSZXNvdXJjZSA9IHJlc291cmNlO1xuICB9XG59XG4iXX0=